# nginx-kibana-conf
This nginx configuration provides the ability to proxy Kibana via nginx wherein we need custom headers for securing Elasticsearch . In the current usage, two custom headers are needed, **Tenant** and **AccessToken**. The initial request coming to nginx will contain these two in the request params . These params are then passed to the upstream which is Kibana in this case via **proxy_set_header**. However since Kibana internally makes many requests to Elasticsearch and every request must contain the necessary headers or else we will be logged out of Kibana. 

To make sure that we pass necessary headers on each request, we need to make every request coming to nginx contain the **Tenant** and **AccessToken** present in the request param wherein they are extracted and passed as request headers to upstream. This will be achieved via redirecting to nginx if the request uri doesn't contain these request params but the http referrer does contain it as we started from a point wherein we initially passed these two params. So on every subsequent request , either the request uri will contain these params or we redirect to a uri with these params by extracting these from the referrer.
